\section{Thống Kê Suy Diễn}
\subsection*{Kiểm tra phân phối chuẩn}
Trước khi lựa chọn các phương pháp thống kê, nhóm phải kiểm tra dữ liệu \textbf{season}, price\textunderscore{total}, order\textunderscore{total}. có tuân theo bảng phân phối chuẩn hay không với phương pháp \textbf{shapiro}.
\begin{lstlisting}[language=R, caption=Shapiro Test]
# Trích xuất các cột order_price và order_total từ merged_data
get_order_price <- merged_data$order_price
get_order_total <- merged_data$order_total

# Kiểm tra phân phối chuẩn với Shapiro-Wilk cho cột order_total
shapiro_order_total <- shapiro.test(get_order_total)
# Kiểm tra phân phối chuẩn với Shapiro-Wilk cho cột order_price
shapiro_order_price <- shapiro.test(get_order_price)

# In kết quả kiểm tra Shapiro-Wilk cho toàn bộ dữ liệu
print(shapiro_order_price)  # Kết quả kiểm tra cho order_price
print(shapiro_order_total)  # Kết quả kiểm tra cho order_total
# Kiểm tra phân phối chuẩn theo từng mùa
seasons <- c("spring", "summer", "fall", "winter")
# Tạo danh sách để lưu giá trị order_price theo từng mùa
order_price_by_season <- list()
# Lặp qua từng mùa, trích xuất dữ liệu và lưu vào danh sách
for (season in seasons) {
  # Trích xuất dữ liệu của từng mùa bằng subset()
  season_data <- subset(merged_data, season == season)  
  # Lưu giá trị order_price của từng mùa vào danh sách
  order_price_by_season[[season]] <- season_data$order_price
}
# Tạo bảng tóm tắt kết quả kiểm tra Shapiro-Wilk cho từng mùa
shapiro_summary <- data.frame(
  Season = names(order_price_by_season),  # Tên các mùa
  P_value = sapply(order_price_by_season, function(order_price) {
    # Tính p-value từ kiểm tra Shapiro-Wilk cho từng mùa
    shapiro.test(order_price)$p.value
  })
)
# Đánh giá phân phối chuẩn: nếu p-value > 0.05 thì phân phối chuẩn
shapiro_summary$Normal_Distribution <- ifelse(shapiro_summary$P_value > 0.05, "True",  # Phân phối chuẩn
"False") # Không phải phân phối chuẩn
# In bảng tóm tắt kết quả kiểm tra Shapiro-Wilk theo mùa
print(shapiro_summary)

\end{lstlisting}
\begin{table}[H]
\centering
\begin{tabular}{|l|r|c|} % Cột: l (trái), r (phải), c (giữa)
\hline
\textbf{Mùa} & \textbf{P-value}       & \textbf{Có phải phân phối chuẩn?} \\ \hline
spring          & 7.348016e-18          & Không                        \\ \hline
summer          & 7.348016e-18          & Không                        \\ \hline
fall            & 7.348016e-18          & Không                        \\ \hline
winter          & 7.348016e-18          & Không                        \\ \hline
\end{tabular}
\caption{Kiểm tra phân phối chuẩn của mùa}
\label{tab:normality_results}
\end{table}
\begin{lstlisting}[language=R,caption=Hai cột còn lại]
> print(shapiro_order_price)  # Kết quả kiểm tra cho order_price
	Shapiro-Wilk normality test
data:  get_order_price
W = 0.95034, p-value < 2.2e-16
> print(shapiro_order_total)  # Kết quả kiểm tra cho order_total
	Shapiro-Wilk normality test
data:  get_order_total
W = 0.94557, p-value < 2.2e-16

% Giới thiệu

\end{lstlisting}
\begin{boxH}
    \textbf{Nhận xét:} Từ những dữ kiện trên, ta có thể kết luận chúng không tuân theo phân phối chuẩn.
\end{boxH}
\subsection{Kiểm định trung bình một mẫu}
\subsubsection{Bài toán thực tế}
Sử dụng t-test , nhóm muốn kiểm tra giả thuyết rằng doanh thu bán hàng của cửa hàng trong mùa Xuân có bằng với giá trị kì vọng ($\mu$ = $50$) không? 
Nhóm đưa ra hai giả thuyết như sau:
\textbf{Giả thuyết kiểm định:}
\begin{itemize}
    \item \( H_0 \): \( \mu = 50 \) (Doanh thu trung bình mùa xuân bằng kỳ vọng)
    \item \( H_1 \): \( \mu > 50 \) (Doanh thu trung bình mùa xuân lớn hơn kỳ vọng)
\end{itemize}

\begin{boxH}
\textbf{Giải thích:} Lí do nhóm sử dụng \textbf{t-test} vì mẫu lớn hơn 30 mẫu, chúng không tuân theo phân phối chuẩn.
\end{boxH}



\subsubsection{Tính giá trị kiểm định}


\subsubsection{Mô tả dữ liệu và công thức tính}

\begin{lstlisting}[language=R, caption=Tính các thông số]
spring_data <- merged_data %>%
  filter(season == "spring")
## Xuất ra trung bình mẫu, sd , muy
spring_stats <- spring_data %>%
  summarise(
    mean = mean(order_total),
    sd = sd(order_total),
    n = n()
  )  
\end{lstlisting}

\begin{table}[h!]
\centering
\begin{tabular}{|l|r|}
\hline
\textbf{Thông số} & \textbf{Giá trị} \\
\hline
Trung bình mẫu \( \bar{X} \) & 12,320 \\
Giá trị kỳ vọng \( \mu_0 \) & 50 \\
Độ lệch chuẩn mẫu \( s \) & 7,757 \\
Số quan sát \( n \) & 266 (vì df = 265) \\
\hline
\end{tabular}
\caption{Các thông số thống kê dùng trong bài toán kiểm định một mẫu}
\label{tab:thongso}
\end{table}

Áp dụng lý thuyết t-test cho một mẫu, ta có công thức tính giá trị kiểm định như sau:
\begin{boxH}
\[
Z_{qs} = \frac{\bar{X} - \mu_0}{\dfrac{s}{\sqrt{n}}}
\]

\textbf{Thay số vào:}

\[
Z = \frac{12320 - 50}{\dfrac{7757}{\sqrt{266}}}
= \frac{12270}{474.89} \approx 25.83
\]
\end{boxH}

\subsubsection{Xử lý trên phần mềm RStudio}
Xử lý trên phần mềm RStudio, nhóm sử dụng hàm \texttt{z.test} để tính giá trị kiểm định và p-value. Cụ thể, nhóm sử dụng hàm này với các tham số như sau:

\begin{lstlisting}[language=R, caption=Kiểm định một mẫu]
z.test(x = spring_data$order_total,
       mu = 50,
       sigma.x = sd(spring_data$order_total),
       alternative = "greater")
\end{lstlisting}


\subsubsection{Kết luận}

\begin{lstlisting}[language=R, caption=Kết quả sau khi dùng t-test]
    One-sample z-Test
data:  spring_data$order_price
z = 28.704, p-value < 2.2e-16
alternative hypothesis: true mean is greater than 50
95 percent confidence interval:
 12920.34       NA
sample estimates:
mean of x 
 13702.69 
\end{lstlisting}

\begin{boxH}
    Kết luận: p-value < 0.05, như vậy ta có thể khẳng định , không đủ điều kiện để bác bỏ $H_0$
\end{boxH}


% Ý tưởng hai mẫu (t-test)
\subsection{Kiểm định trung bình hai mẫu}
\subsubsection{Bài toán thực tế}
Sau khi đã xác định được doanh thu của cửa hàng tại mùa xuân không vượt qua giá trị kì vọng, nhóm tiếp tục đem so sánh dữ liệu \textbf{mùa xuân}
so với \textbf{mùa hè} với mức ý nghĩa $\alpha$ = 0.05

Nhóm đặt giả thuyết như sau
\begin{itemize}
    \item \textbf{Giả thuyết không (H\textsubscript{0}):} $\mu_1 = \mu_2$ (Doanh thu trung bình mùa xuân bằng mùa hè)
    \item \textbf{Giả thuyết đối (H\textsubscript{1}):} $\mu_1 \ne \mu_2$ (Có sự khác biệt giữa 2 mùa)
\end{itemize}
\subsubsection{Tính giá trị kiểm định}
Để tính giá trị kiểm định, nhóm sử dụng phương pháp tách 2 mẫu \textbf{xuân} và \textbf{hè} ra làm 2 và lọc ra thông số độ lệch chuẩn, n (số mẫu) và mean (trung bình mẫu)

\begin{lstlisting}[language=R, caption=Các thông số thống kê dùng trong kiểm định trung bình 2 mẫu ]

\begin{lstlisting}[language=R, caption= z-test]
group_stats <- merged_data %>%
  group_by(season) %>%
  summarise(
    mean = mean(order_total),
    sd = sd(order_total),
    n = n(),
    .groups = "drop"  # tránh cảnh báo nhóm
  ) %>%
  filter(season %in% c("spring", "summer"))

print(group_stats)

# Độ lệch chuẩn 2 mùa xuân và hè 
sd_spring <- group_stats$sd[group_stats$season == "spring"]
sd_summer <- group_stats$sd[group_stats$season == "summer"]

## Tổng giá trị đơn hàng trong 2 mùa
spring_data <- merged_data$order_total[merged_data$season == "spring"]
summer_data <- merged_data$order_total[merged_data$season == "summer"]
### Z -test
z_test_result <- z.test(x = spring_data, y = summer_data,
       mu = 0,
       sigma.x = sd_spring,
       sigma.y = sd_summer,
       alternative = "two.sided")

print(z_test_result)
\end{lstlisting}
\subsubsection{Mô tả dữ liệu và công thức tính}
\begin{table}[H]
\centering
\caption{ Chỉ số bài toán \texttt{order\_total} theo mùa Xuân và Hè}
\begin{tabular}{@{}lccc@{}}
\textbf{Mùa} & \textbf{Trung bình (\textmu)} & \textbf{Độ lệch chuẩn (s)} & \textbf{Số lượng (n)} \\
Xuân (Spring) & 12,320 & 7,757 & 266 \\
Hè (Summer)   & 12,487 & 7,697 & 249 \\
\end{tabular}
\end{table}
\begin{boxH}
Trong phần lý thuyết, nhóm đã đề cập phương pháp t-test cho hai mẫu. Do đó nhóm sẽ sử dụng công thức tính giá trị kiểm định và thông số trong bảng mô tả dữ liệu như sau:
\[
Z = \frac{12319.55 - 12486.75}{\sqrt{\frac{7757.41^2}{266} + \frac{7697.42^2}{249}}} \approx -0.24542
\]
  
\end{boxH}
\subsubsection{Xử lý trên phần mềm RStudio}
Xử lý trên phần mềm RStudio, nhóm sử dụng hàm \texttt{t.test} để tính giá trị kiểm định và p-value. Cụ thể, nhóm sử dụng hàm này với các tham số như sau:
\begin{lstlisting}[language=R, caption=Các thông số thống kê dùng trong kiểm định trung bình 2 mẫu ]
  t_test_result_two_sample<-t.test(order_total ~ season, 
       data = merged_data %>% filter(season %in% c("spring", "summer")),
       var.equal = FALSE) # giả định phương sai không bằng nhau
print(t_test_result_two_sample)
\end{lstlisting}

\begin{lstlisting}[language=R, caption= Kết quả t-test]
		Welch Two Sample t-test

data:  order_total by season
t = -0.24542, df = 511.26, p-value = 0.8062
alternative hypothesis: true difference in means between group spring and group summer is not equal to 0
95 percent confidence interval:
 -1505.705  1171.298
sample estimates:
mean in group spring mean in group summer 
            12319.55             12486.75 
\end{lstlisting}

\subsubsection{Kết luận}
\begin{boxH}

Với $p_value = 0.8602 > 0.05$ , nhóm không có đủ bằng chứng để bác bỏ giả thuyết $H_0$ tức là không có sự khác biệt trong doanh thu giữa hai mùa.

\end{boxH}
% Annova
\subsection{Annova một yếu tố}

\subsubsection{Bài toán thực tế}
Một cửa hàng điện tử muốn kiểm tra xem \textbf{giá trị đơn hàng trung bình} (\texttt{order\_total}), với cỡ mẫu của mỗi nhóm là $30$, có bị ảnh hưởng bởi \textbf{mùa vụ} (\texttt{season}) hay không.  
Dữ liệu được thu thập từ các đơn hàng, phân loại thành $4$ nhóm theo mùa: \textbf{Winter} (mùa đông), \textbf{Summer} (mùa hè), \textbf{Autumn} (mùa thu) và \textbf{Spring} (mùa xuân).  

Với mức ý nghĩa $\alpha = 5\%$, sử dụng phương ph \textbf{mô hình ANOVA một yếu tố} để kiểm tra xem giá trị đơn hàng trung bình giữa các mùa có sự khác biệt đáng kể hay không.
\subsubsection{Giả thuyết kiểm định}

\begin{itemize}
  \item Các tổng thể phải tuân theo phân phối chuẩn $N(\mu, \sigma^2)$
  \item Số nhóm $k=4$
  \item Phương sai bằng nhau $\sigma_1^2 = \sigma_2^2 = \sigma_3^2 = \sigma_4^2$
  \item Các mẫu quan sát (từ $k$ tổng thể) được lấy độc lập, với $n = 30$ cho mỗi nhóm, tổng số quan sát $N = 120$.
\end{itemize}

\subsubsection{Hiện thực phép toán}
Gọi $\mu_i$ là giá trị đơn hàng trung bình của mùa thứ $i$.
\begin{align*}
    H_0 &: \mu_1 = \mu_2 = \mu_3 = \mu_4, \\
    H_1 &: \exists\ i \neq j \ \text{sao cho} \ \mu_i \neq \mu_j.
\end{align*}

\subsubsection{Tính các tham số mẫu}
\begin{table}[H]
\centering
\caption{Trung bình và phương sai mẫu theo mùa}
\begin{tabular}{lcc}
\hline
Mùa & Trung bình mẫu $\overline{x}_i$ & Phương sai mẫu $s_i^2$ \\ \hline
Winter  & $12499.31$ & $56,686,589.91$ \\
Summer  & $12493.37$ & $61,622,987.35$ \\
Autumn  & $12858.15$ & $48,321,908.37$ \\
Spring  & $14594.52$ & $106,019,827.40$ \\ \hline
\end{tabular}
\end{table}

\subsubsection{Giá trị trong và giữa các nhóm}

\paragraph{Tổng bình phương giữa nhóm (SSB):}
\[
SSB = 14,303,293.20 + 14,550,442.35 + 3,299,751.675 + 55,465,154.35 = 87,618,641.575
\]
Bình phương trung bình giữa nhóm (MSB):
\[
MSB = \frac{SSB}{k-1} = \frac{87,618,641.575}{3} \approx 29,206,213.86
\]

\paragraph{Tổng bình phương trong nhóm (SSW):}
\[
SSW = 1,643,911,107 + 1,787,066,635 + 1,401,335,343 + 3,074,574,995 = 7,906,888,080
\]
Bình phương trung bình trong nhóm (MSW):
\[
MSW = \frac{SSW}{N-k} = \frac{7,906,888,080}{116} \approx 68,162,828.28
\]

\subsubsection{Giá trị thống kê kiểm định}
\[
F = \frac{MSB}{MSW} = \frac{29,206,213.86}{68,162,828.28} \approx 0.4285
\]

\subsubsection{Miền bác bỏ}
Với $\alpha = 5\%$, $df_1 = k-1 = 3$, $df_2 = N-k = 116$:
\[
F_{0.05; 3; 116} \approx 2.6802
\]
Miền bác bỏ:
\[
RR = (2.6802, +\infty)
\]

\subsubsection{Kết luận}
\begin{boxH}

\textbf{Kết luận:} 
Vì $F \approx 0.4285 < 2.6802$, không bác bỏ $H_0$ nên không có bằng chứng thống kê cho thấy giá trị đơn hàng trung bình giữa các mùa khác biệt đáng kể.

\end{boxH}

\subsection{Xử lý trên phần mềm R}
Sử dụng phương pháp leveneTest trong R để thực hiện
\begin{lstlisting}[language=R, caption=Phép kiểm ANOVA một yếu tố]
##################################################
# 9. ANOVA (4 mùa)
##################################################
df_cleaned <- merged_data %>%
  group_by(season) %>%
  mutate(order_total_cleaned = ifelse(order_total > quantile(order_total, 0.75) + 1.5 * IQR(order_total) |
                                      order_total < quantile(order_total, 0.25) - 1.5 * IQR(order_total),
                                      NA, order_total)) %>%
  ungroup()

leveneTest(order_total_cleaned ~ season, data = df_cleaned)

anova_model <- aov(order_total_cleaned ~ season, data = df_cleaned)
summary(anova_model)

# Boxplot ANOVA
ggplot(df_cleaned, aes(x = season, y = order_total_cleaned)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "So sánh Order Total giữa các mùa (ANOVA)")

\end{lstlisting}

\begin{lstlisting}[language=R, caption=Kết quả ANOVA một yếu tố]
Df    Sum Sq   Mean Sq F value Pr(>F)  
season        3 3.576e+08 119214928   2.299 0.0759 .
Residuals   981 5.086e+10  51848700 
  
\end{lstlisting}
Kết luận: Không đủ điều kiện để bác bỏ giả thuyết $H_0$ với $p$-value = 0.0759 > 0.05, tức là không có sự khác biệt đáng kể giữa giá trị đơn hàng trung bình của các mùa.
% --------------------
\pagebreak
\subsection{Hồi quy tuyến tính}

\subsubsection{Bài toán thực tế}
Xây dựng mô hình hồi quy tuyến tính với biến phụ thuộc:
\[
Y = \texttt{order\_price}
\]
và hai biến độc lập:
\[
X_1 = \texttt{coupon\_discounts}, \quad X_2 = \texttt{delivery\_charges}.
\]
Mô hình hồi quy bội được viết dưới dạng:
\[
Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \varepsilon_i, \quad i = 1, 2, \ldots, n
\]
trong đó:
\begin{itemize}
    \item $Y$: Giá trị đơn hàng (\texttt{order\_price})
    \item $X_1$: Giảm giá bằng coupon (\texttt{coupon\_discounts})
    \item $X_2$: Phí giao hàng (\texttt{delivery\_charges})
    \item $\varepsilon_i$: Sai số ngẫu nhiên, có kỳ vọng $E(\varepsilon) = 0$, phương sai $\sigma^2$
\end{itemize}

\subsubsection{Cơ sở lý thuyết}
Mô hình hồi quy bội mở rộng mô hình hồi quy đơn bằng cách đưa vào nhiều biến độc lập:
\[
Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \dots + \beta_p X_p + \varepsilon
\]
\begin{itemize}
    \item $\beta_0$: Hệ số chặn
    \item $\beta_j$: Hệ số hồi quy của biến độc lập $X_j$
    \item $\varepsilon$: Sai số ngẫu nhiên
\end{itemize}

\subsubsection{Phương pháp ước lượng}
Sử dụng phương pháp \textbf{Bình phương tối thiểu (OLS)}:
\[
\hat{\beta} = (X^\mathsf{T}X)^{-1} X^\mathsf{T} Y
\]
trong đó:
\begin{itemize}
    \item $X$: Ma trận giá trị các biến độc lập $(n \times (p+1))$
    \item $Y$: Vector giá trị của biến phụ thuộc $(n \times 1)$
    \item $\hat{\beta}$: Vector hệ số hồi quy $(p+1) \times 1$
\end{itemize}

\paragraph{Hệ số xác định $R^2$:}
\[
R^2 = 1 - \frac{SS_\text{res}}{SS_\text{tot}}
\]
với:
\[
SS_\text{res} = \sum_{i=1}^n (y_i - \hat{y}_i)^2, \quad SS_\text{tot} = \sum_{i=1}^n (y_i - \overline{y})^2
\]

\subsubsection{Kết quả mô hình OLS}
Mô hình trong R:
\begin{verbatim}
model <- lm(order_price ~ coupon_discount + delivery_charges, data = df)
summary(model)
\end{verbatim}

\paragraph{Kiểm tra đa cộng tuyến:}
\begin{verbatim}
vif(model)
# coupon_discount: 1.000546
# delivery_charges: 1.000546
\end{verbatim}
$\Rightarrow$ VIF xấp xỉ 1 cho cả hai biến, không xảy ra đa cộng tuyến.

\paragraph{Hệ số ước lượng:}
\[
\hat{\beta}_0 = 13297.85, \quad \hat{\beta}_1 = 143.66, \quad \hat{\beta}_2 = 59.37
\]
Ý nghĩa:
\begin{itemize}
    \item Khi $X_1$ tăng 1 đơn vị, $Y$ tăng trung bình $143.66$
    \item Khi $X_2$ tăng 1 đơn vị, $Y$ tăng trung bình $59.37$
\end{itemize}

\paragraph{Kiểm định $t$:}
\begin{itemize}
    \item $X_1$: $p = 0.527 > 0.05$ $\Rightarrow$ không đủ bằng chứng biến có ý nghĩa
    \item $X_2$: $p = 0.662 > 0.05$ $\Rightarrow$ không đủ bằng chứng biến có ý nghĩa
\end{itemize}

\paragraph{Kiểm định $F$:}
$p$-value lớn hơn 0.05, $R^2 \approx 0$ $\Rightarrow$ mô hình không có ý nghĩa thống kê, biến phụ thuộc quan hệ yếu với các biến độc lập.
\input{Sections/6_Mo_Rong}